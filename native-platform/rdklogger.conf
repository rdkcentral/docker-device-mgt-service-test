# RDK Logger rsyslog configuration
# This extracts logs from syslog to individual log files based on category
# All RDK logs come from user facility with LOG.RDK.* in message content

# Template for RDK logger format (timestamp + message)
template(name="RDKLogFormat" type="string" string="%timestamp:::date-rfc3339% %msg%\n")

# Filter RDK messages by category/subtag in the message content (user facility)
if ($syslogfacility-text == 'user') then {
    # Telemetry logs - LOG.RDK.T2
    if ($msg contains '[T2]' or $msg contains 'LOG.RDK.T2') then {
        action(type="omfile" file="/opt/logs/telemetry2_0.txt" template="RDKLogFormat")
        stop
    }
    
    # Firmware Update logs - LOG.RDK.FWUPG
    if ($msg contains '[FWUPG]' or $msg contains 'LOG.RDK.FWUPG') then {
        action(type="omfile" file="/opt/logs/swupdate.txt" template="RDKLogFormat")
        stop
    }
    
    # RFC Manager logs - LOG.RDK.RFCMGR
    if ($msg contains '[RFCMGR]' or $msg contains 'LOG.RDK.RFCMGR') then {
        action(type="omfile" file="/opt/logs/rfcscript.txt" template="RDKLogFormat")
        stop
    }
    
    # RFC API logs - LOG.RDK.RFCAPI
    if ($msg contains '[RFCAPI]' or $msg contains 'LOG.RDK.RFCAPI') then {
        action(type="omfile" file="/opt/logs/rfcscript.txt" template="RDKLogFormat")
        stop
    }
    
    # TR181 API logs - LOG.RDK.TR181API
    if ($msg contains '[TR181API]' or $msg contains 'LOG.RDK.TR181API') then {
        action(type="omfile" file="/opt/logs/rfcscript.txt" template="RDKLogFormat")
        stop
    }
    
    # Remote Debugger logs - LOG.RDK.REMOTEDEBUGGER
    if ($msg contains '[REMOTEDEBUGGER]' or $msg contains 'LOG.RDK.REMOTEDEBUGGER') then {
        action(type="omfile" file="/opt/logs/remotedebugger.log" template="RDKLogFormat")
        stop
    }

    # Log Upload logs - LOG.RDK.UPLOADSTB
    if ($msg contains '[UPLOADSTB]' or $msg contains 'LOG.RDK.UPLOADSTB') then {
        action(type="omfile" file="/opt/logs/logupload.log" template="RDKLogFormat")
        stop
    }
    
    # Common Utilities logs - LOG.RDK.COMMONUTILITIES
    if ($msg contains '[COMMONUTILITIES]' or $msg contains 'LOG.RDK.COMMONUTILITIES') then {
        action(type="omfile" file="/opt/logs/logcommon.log" template="RDKLogFormat")
        stop
    }
    
    # TR69 Host Interface logs - LOG.RDK.TR69HOSTIF
    if ($msg contains '[TR69HOSTIF]' or $msg contains 'LOG.RDK.TR69HOSTIF') then {
        action(type="omfile" file="/opt/logs/tr69hostif.log" template="RDKLogFormat")
        stop
    }
    
    # System Time Manager logs - LOG.RDK.SYSTIMEMGR
    if ($msg contains '[SYSTIMEMGR]' or $msg contains 'LOG.RDK.SYSTIMEMGR') then {
        action(type="omfile" file="/opt/logs/systimemgr.log" template="RDKLogFormat")
        stop
    }
    
    # DCM Agent logs - LOG.RDK.DCM
    if ($msg contains '[DCM]' or $msg contains 'LOG.RDK.DCM') then {
        action(type="omfile" file="/opt/logs/dcmd.log" template="RDKLogFormat")
        stop
    }
    
    # RDM Agent logs - LOG.RDK.RDMAGENT
    if ($msg contains '[RDMAGENT]' or $msg contains 'LOG.RDK.RDMAGENT') then {
        action(type="omfile" file="/opt/logs/rdm_status.log" template="RDKLogFormat")
        stop
    }
    
    # Crash Upload logs - LOG.RDK.CRASHUPLOAD
    if ($msg contains '[CRASHUPLOAD]' or $msg contains 'LOG.RDK.CRASHUPLOAD') then {
        action(type="omfile" file="/opt/logs/core_log.txt" template="RDKLogFormat")
        stop
    }
}